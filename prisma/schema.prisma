generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // provider = "sqlite"
}

model User {
  id             String   @id @default(uuid())
  ea_id          String   @unique
  name           String
  username       String?  @unique
  password       String?
  role           Role     @default(USER)
  avatar         String?
  bio            String?
  rank           Ranks    @default(RECRUTA)
  platform       Platform
  status         Status   @default(PENDING)
  trackergg      String?
  createdAt      DateTime @default(now())
  
  userStats          Stats[]
  userInvites        Invite[]
  userMedals         UserMedal[]
  userTopStats       TopStats[] 
}

model Stats {
  id        String @id @default(uuid())
  user_id   String @unique

  kills               Int      @default(0)
  deaths              Int      @default(0)
  wins                Int      @default(0)
  losses              Int      @default(0)
  hsPercent           Float    @default(0)
  assists             Int      @default(0)
  revives             Int      @default(0)
  killDeath           Float    @default(0)
  objectivesCaptured  Int      @default(0)
  objectivesDestroyed Int      @default(0)
  matchesPlayed       Int      @default(0)
  winPercent          String?
  bestClass           String?
  timePlayed          String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model ClanStats {
  id            String @id @default(uuid())
  totalMembers  Int @default(0)
  totalMedals   Int @default(0)
  averageKd     Float @default(0)
  averageWins   Float @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Medal {
  id          String   @id @default(uuid())
  name        String
  description String
  rarity      Rarity   @default(COMMON)
  image       String?
  createdAt   DateTime @default(now())

  userMedals UserMedal[]
}

model UserMedal {
  id        String   @id @default(uuid())
  user_id   String
  medal_id  String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  medal     Medal    @relation(fields: [medal_id], references: [id], onDelete: Cascade)

  @@unique([user_id, medal_id], name: "user_id_medal_id")
}

model Invite {
  id        String    @id @default(uuid())
  user_id   String
  token     String    @unique
  expiresAt DateTime
  used      Boolean   @default(false)
  createdAt DateTime  @default(now())
  usedAt    DateTime?
  
  user      User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model TopStats {
  id         String           @id @default(uuid())
  category   TopStatsCategory @unique
  user_id    String?
  updatedAt  DateTime         @updatedAt

  user       User?             @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

enum Platform {
  PC
  PLAYSTATION
  XBOX
}

enum Role {
  ADMIN
  USER
}

enum Ranks {
  RECRUTA
  SOLDADO
  CABO
  SARGENTO
  TENENTE
  CAPITAO
  MAJOR
  CORONEL
  GENERAL
}

enum Status {
  ACTIVE
  INACTIVE
  PENDING
  BANNED
}

enum Rarity {
  COMMON
  RARE
  EPIC
  LEGENDARY
  UNIQUE
}

enum TopStatsCategory {
  KILLS_DEATHS
  KILLS
  REVIVES
  ASSISTS
  MATCHES
  TIME_PLAYED
}

enum RankingStatus {
  PENDING     
  RUNNING     
  CLOSED      
}